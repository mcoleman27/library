<!doctype html>
<meta charset="utf-8">

<script src="https://d3js.org/d3.v5.js"></script>
<script src="https://d3js.org/d3-selection-multi.v1.js"></script>

<script type="module" src="drawgrid.js"></script>

<title>
  Page Title
</title>

<style>
  #column {
    width: 400px;
    height: 500px;
    background-color: darkgray;
  }
  #chart {
    width: 100%;
    height: 400px;
    background-color: lightgrey;
  }
</style>

<body>
  <div id="column">
    <div id="chart"></div>
  </div>
</body>

<script type="module">
  import {getData} from "./data.js"

  import {drawGrid} from "./drawgrid.js"
  
  import {histogram} from "./plots.js"
  import {density} from "./density.js"

  let chartWidth  = d3.select("#column").node().clientWidth,
      chartHeight = parseInt(d3.select("#chart").style("height"));

  let div = d3.select("#chart");

  let svg = div
    .append("svg")
    .attrs({"width": div.node().clientWidth, "height": div.node().clientHeight})

  const data = getData();



  function drawCell(svg, i, j){
    
    const width = svg.attr("width"),
        height = svg.attr("height")

    if(i == j){
      histogram(svg, data)
      density(svg, data, 0.5)
    } else {
      // Placeholder stuff for off-diagonal cells
      
      let colour = '#'+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6)

      let g = svg.append("g")

      g
        .append("rect")
        .attr("width", width)
        .attr("height", height)
        .attr("fill", colour)

      let data = [4,7,2,5,1,7,8,1,1,4]

      let y = d3.scaleLinear()
        .domain([0, 8])
        .range([height, 0]);

      g
        .selectAll("rect")
        .data(data)  
        .enter()
        .append("rect")
        .attr("y",d => y(d))
        .attr("x", (d,i) => i * 10)
        .attr("width", 10)
        .attr("height", d => height - y(d))
        .attr("fill", "black"); 
    }
  }

  drawGrid(svg, 3, 3, drawCell);
</script>